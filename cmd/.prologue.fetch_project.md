# cmd/fetch-projects

This subcommand is responsible for retrieving the list of accessible TiDB Cloud projects
via the [public API](https://docs.pingcap.com/tidbcloud/api/v1beta/#tag/Project/operation/ListProjects) and storing them into the database.

## Purpose

Provide a standalone, testable CLI entry point for fetching and persisting project metadata.
This forms the foundation of project-related data flow within the tool.

## Behavior

* Receive arguments and flags from the command line, and parse them
* Load sensitive configurations such as password and API credentials from environment variables.
* Calls the service layer (`ProjectService`) to perform fetch-and-store logic
* Delegates execution to `runFetchAndStoreProjectsService`, which orchestrates the operation
* Logs errors and results in a human-friendly manner
* Returns non-zero exit code on failure

## Structure

`fetch_projects.go`: CLI command entry point. It:
- Parses CLI arguments via `parseFetchProjectArgs`
- Validates inputs via `validateFetchProjectArgs`
- Initializes API fetcher and DB store
- Delegates fetch/store operation to `ProjectService`

## Internals

* The command collects CLI flags into a `fetchProjectArgs` struct, improving readability and testability.
* Only minimal logic is embedded in the command body â€” all business logic resides in the `internal/project` module.

## Environment Variables

This command supports the following environment variables for sensitive data:

- `MSK_API_TOKEN`: Used for authenticating with the TiDB Cloud API
- `MSK_DB_PASSWORD`: Used for connecting to the target database

## Ownership

* This subcommand is owned by the `internal/project` module.
* This command **must not** directly access APIs or the database; it delegates to the service layer.

## Future Extensions

* Add flags for filtering by project name
* JSON output for machine consumption
